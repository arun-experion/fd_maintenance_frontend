import { __decorate } from 'tslib';
import { ɵɵdefineInjectable, Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { map, shareReplay } from 'rxjs/operators';

var Model = /** @class */ (function () {
    function Model(initialData, immutable, sharedSubscription, clone) {
        var _this = this;
        this.immutable = immutable;
        this.clone = clone;
        this._data = new BehaviorSubject(initialData);
        this.data$ = this._data.asObservable().pipe(map(function (data) {
            return _this.immutable
                ? clone
                    ? clone(data)
                    : JSON.parse(JSON.stringify(data))
                : data;
        }), sharedSubscription
            ? shareReplay({ bufferSize: 1, refCount: true })
            : map(function (data) { return data; }));
    }
    Model.prototype.get = function () {
        var data = this._data.getValue();
        return this.immutable
            ? this.clone
                ? this.clone(data)
                : JSON.parse(JSON.stringify(data))
            : data;
    };
    Model.prototype.set = function (data) {
        if (this.immutable) {
            var clone = this.clone
                ? this.clone(data)
                : JSON.parse(JSON.stringify(data));
            this._data.next(clone);
        }
        else {
            this._data.next(data);
        }
    };
    return Model;
}());
var ModelFactory = /** @class */ (function () {
    function ModelFactory() {
    }
    ModelFactory.prototype.create = function (initialData) {
        return new Model(initialData, true, false);
    };
    ModelFactory.prototype.createMutable = function (initialData) {
        return new Model(initialData, false, false);
    };
    ModelFactory.prototype.createMutableWithSharedSubscription = function (initialData) {
        return new Model(initialData, false, true);
    };
    ModelFactory.prototype.createWithCustomClone = function (initialData, clone) {
        return new Model(initialData, true, false, clone);
    };
    ModelFactory.prototype.createWithConfig = function (config) {
        var initialData = config.initialData, immutable = config.immutable, sharedSubscription = config.sharedSubscription, clone = config.clone;
        return new Model(initialData, immutable, sharedSubscription, clone);
    };
    ModelFactory.ngInjectableDef = ɵɵdefineInjectable({ factory: function ModelFactory_Factory() { return new ModelFactory(); }, token: ModelFactory, providedIn: "root" });
    ModelFactory = __decorate([
        Injectable({
            providedIn: 'root'
        })
    ], ModelFactory);
    return ModelFactory;
}());

/**
 * Generated bundle index. Do not edit.
 */

export { Model, ModelFactory };
//# sourceMappingURL=angular-extensions-model.js.map
